{
  "name": "refactor-pipeline",
  "description": "안전한 리팩토링 파이프라인",
  "stages": [
    {
      "name": "analyze",
      "agent": "rails-architect",
      "model": "opus",
      "prompt": "리팩토링 대상을 분석하고 계획을 수립합니다.",
      "outputs": ["analysis", "refactor_plan"]
    },
    {
      "name": "specs-first",
      "agent": "rspec-tester",
      "model": "sonnet",
      "prompt": "리팩토링 전 기존 동작을 보장하는 테스트를 확인/추가합니다.",
      "inputs": ["analysis"],
      "outputs": ["baseline_specs"]
    },
    {
      "name": "refactor",
      "agent": "rails-executor-high",
      "model": "opus",
      "prompt": "계획대로 리팩토링을 수행합니다.",
      "inputs": ["refactor_plan", "baseline_specs"],
      "outputs": ["refactored_code"]
    },
    {
      "name": "verify",
      "agent": "rspec-tester",
      "model": "sonnet",
      "prompt": "모든 테스트가 통과하는지 확인합니다.",
      "inputs": ["baseline_specs", "refactored_code"],
      "outputs": ["verification"]
    }
  ],
  "triggers": ["refactor", "refactoring"],
  "invocation": "/rails8:pipeline refactor"
}
