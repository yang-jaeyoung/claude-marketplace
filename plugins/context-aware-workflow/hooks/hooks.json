{
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "## Session Start - CAW Workflow Detection\n\n### Step 1: Restore Previous Session (session-persister skill)\n\nCheck for existing CAW session:\n\n1. Check if `.caw/sessions/current.json` exists\n2. If exists and recent (< 24 hours):\n   ```\n   ðŸ”„ ì´ì „ ì„¸ì…˜ ë°œê²¬\n   \n   Session: [session_id]\n   Task: [task_title]\n   Progress: [phase]/[total_phases], Step [step] ([progress]%)\n   Last Activity: [time_ago]\n   \n   [1] ì´ì „ ì„¸ì…˜ ì´ì–´ì„œ ì§„í–‰\n   [2] ì„¸ì…˜ ìƒíƒœ í™•ì¸ë§Œ (/caw:status)\n   [3] ìƒˆë¡œ ì‹œìž‘ (ì´ì „ ì„¸ì…˜ ì•„ì¹´ì´ë¸Œ)\n   ```\n3. If no session, continue silently.\n\n### Step 2: Detect Plan Mode Output (plan-detector skill)\n\nCheck for Plan Mode plans:\n\n1. Check `.claude/plans/` for recent plan files\n2. If found (modified < 1 hour ago) and no active CAW workflow:\n   ```\n   ðŸŽ¯ Plan Mode ê³„íš ê°ì§€\n   \n   íŒŒì¼: [plan_path]\n   ìš”ì•½: [plan_title]\n   \n   CAW ì›Œí¬í”Œë¡œìš°ë¡œ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n   [1] /caw:start --from-plan ì‹¤í–‰\n   [2] ê³„íš ë¯¸ë¦¬ë³´ê¸°\n   [3] ë‚˜ì¤‘ì— ê²°ì •\n   ```\n\nIMPORTANT: This is informational only. Do not block the session."
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "hooks": [
          {
            "matcher": "Edit|Write",
            "type": "prompt",
            "prompt": "## Pre-File Modification Check\n\nBefore this file modification:\n\n1. Check if `.caw/task_plan.md` exists\n2. If it does NOT exist AND this is a code file:\n   - Display brief warning (not blocking):\n     ```\n     âš ï¸ task_plan.md ì—†ìŒ. êµ¬ì¡°í™”ëœ ì›Œí¬í”Œë¡œìš°: /caw:start\n     ```\n   - Continue with operation\n3. If task_plan.md exists: Continue silently\n\nSkip check for:\n- .caw/ directory files\n- Config files (package.json, tsconfig.json, etc.)\n- Documentation files (*.md in root)\n- Git/env files\n\nIMPORTANT: WARNING only. Never block the operation."
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "ExitPlanMode",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "## Plan Mode Completed (plan-detector skill)\n\nPlan Modeê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. CAW ì›Œí¬í”Œë¡œìš° ì‹œìž‘ì„ ì œì•ˆí•©ë‹ˆë‹¤:\n\n1. ìµœê·¼ Plan íŒŒì¼ í™•ì¸ (`.claude/plans/`)\n2. Plan ë‚´ìš© ë¶„ì„:\n   - êµ¬í˜„ ë‹¨ê³„ ìˆ˜ íŒŒì•…\n   - ì˜ˆìƒ íŒŒì¼ ë³€ê²½ ì‚¬í•­ í™•ì¸\n3. ì‚¬ìš©ìžì—ê²Œ ì˜µì…˜ ì œì‹œ:\n   ```\n   ðŸŽ¯ Plan Mode ì™„ë£Œ\n   \n   ê³„íš íŒŒì¼: [plan_path]\n   ë¶„ì„ ê²°ê³¼:\n     âœ… êµ¬í˜„ ë‹¨ê³„: [N] Phases, [M] Steps\n     âœ… ì˜ˆìƒ íŒŒì¼: [X]ê°œ ë³€ê²½\n   \n   CAW ì›Œí¬í”Œë¡œìš° ì˜µì…˜:\n   [1] ìžë™ ì‹œìž‘ - /caw:start --from-plan\n   [2] ì„¤ê³„ ë¨¼ì € - /caw:design\n   [3] ìˆ˜ë™ ì§„í–‰ - ë‚˜ì¤‘ì— ì§ì ‘ ì‹œìž‘\n   ```"
          }
        ]
      },
      {
        "matcher": "Edit|Write|Read",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "## Context & Progress Tracking (Silent)\n\n### Context Manager\nIf `.caw/context_manifest.json` exists:\n- For Read: Update last_accessed timestamp\n- For Edit/Write: Move file to 'active' tier\n- Update stats.total_tokens estimate\n\n### Progress Tracker (progress-tracker skill)\nIf `.caw/task_plan.md` exists and step is in_progress:\n- Update `.caw/metrics.json` with activity\n- Track file modifications for current step\n\nSkip for:\n- .caw/ directory files\n- node_modules/, .git/\n- Temporary files\n\nIMPORTANT: Runs silently. No user output."
          }
        ]
      },
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "## Insight Protocol Reminder (insight-collector skill)\n\nWhen generating `â˜… Insight` blocks:\n\n1. Display the insight to the user\n2. **Immediately save** using Write tool:\n   - Path: `.caw/insights/{YYYYMMDD}-{slug}.md`\n   - Use template from `skills/insight-collector/templates/`\n3. Confirm: `ðŸ’¡ Insight saved: [title]`\n\nInsight ìƒì„± = ì¦‰ì‹œ ì €ìž¥. Do not defer saving to later."
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "## Session End - State Persistence (session-persister skill)\n\nBefore session ends, save workflow state:\n\n1. Check if CAW workflow is active (`.caw/task_plan.md` exists)\n2. If active:\n   - Parse current progress from task_plan.md\n   - Gather active context files\n   - Save to `.caw/sessions/current.json`:\n     ```json\n     {\n       \"session_id\": \"sess_[timestamp]\",\n       \"task_title\": \"[from task_plan]\",\n       \"current_phase\": \"[phase_n]\",\n       \"current_step\": \"[step_id]\",\n       \"progress_percentage\": [percent],\n       \"last_updated\": \"[iso_timestamp]\"\n     }\n     ```\n   - Brief confirmation: `ðŸ’¾ ì„¸ì…˜ ì €ìž¥ë¨: [progress]%`\n\n3. If no active workflow: Continue silently\n\nIMPORTANT: Quick save only. Do not delay session end."
          }
        ]
      }
    ]
  }
}
