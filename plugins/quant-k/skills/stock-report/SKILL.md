---
name: stock-report
description: 주식 종합분석 리포트 생성. "삼성전자 분석해줘", "005930 종합분석", "동운아나텍 매수타이밍 분석" 등의 요청에 자동 활성화됩니다.
argument-hint: <종목명|종목코드> [리포트 저장 경로]
---

# 주식 종합분석 리포트 스킬

한국 주식(KOSPI/KOSDAQ) 종목의 종합분석 리포트를 생성합니다.

## 사전 요구사항

이 스킬은 Python과 pykrx가 필요합니다. 처음 사용 시 `/quant-k:setup`을 실행하세요.

## 자동 활성화 패턴

다음과 같은 자연어 요청에 이 스킬이 자동 활성화됩니다:

- "삼성전자 분석해줘"
- "005930 종합분석"
- "동운아나텍 매수타이밍 분석해서 저장해줘"
- "SK하이닉스 리포트 만들어줘"

## 데이터 수집 방법

Python 스크립트를 직접 실행하여 KRX 데이터를 조회합니다:

### 1. 종목 확인
```bash
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" search "종목명"
# 또는
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" ticker_info "종목코드"
```

### 2. 가격 데이터 (1년)
```bash
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" ohlcv "종목코드" --days 365
```

### 3. 펀더멘털 지표
```bash
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" fundamental "종목코드"
```

### 4. 시가총액
```bash
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" market_cap "종목코드"
```

### 5. 병렬 데이터 수집 (권장)
```bash
# Phase 1 데이터를 병렬로 수집 (ohlcv + fundamental + market_cap 동시 실행)
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" collect_all "종목코드" --days 365
```

이 명령어 하나로 2-4번의 데이터를 동시에 수집합니다 (약 3배 빠름).

## 분석 워크플로우

### 1단계: 종목 식별
- 종목명이면 search로 종목코드 찾기
- 종목코드면 ticker_info로 확인

### 2단계: 데이터 수집

**권장: 병렬 수집**
```bash
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" collect_all "종목코드" --days 365
```

**개별 수집 (필요 시)**
1. `ticker_info` - 종목 기본정보
2. `ohlcv --days 365` - 1년 가격 데이터
3. `fundamental` - PER, PBR, EPS, BPS, DIV
4. `market_cap` - 시가총액 및 시장 내 순위

### 3단계: 분석 수행
- 52주 고가/저가 대비 현재 위치
- 이동평균선 (MA20/60/120) 분석
- 밸류에이션 평가
- 모멘텀 분석 (수익률 추이)

### 4단계: 리포트 생성
마크다운 형식의 종합 리포트 생성

## 출력 형식

### 콘솔 출력 (요약)
```
📊 삼성전자 (005930) 종합분석

현재가: 160,700원 (전일대비 -1.0%)
시가총액: 959조원 (KOSPI 1위)

밸류에이션:
  PER 32.46
  PBR 2.77
  배당수익률 0.9%

52주 가격범위:
  고가: 166,600원 (현재 -3.5%)
  저가: 149,200원 (현재 +7.7%)

이동평균:
  20일: 158,XXX원 (현재가 위)
  60일: 15X,XXX원
  120일: 15X,XXX원

💡 투자의견: [분석 결과에 따른 의견]
```

### 파일 저장
```
/stock-report 삼성전자 report/
→ report/삼성전자_20260129.md 저장
```

## 리포트 템플릿

```markdown
# {종목명} ({종목코드}) 종합분석 리포트

> 생성일: {날짜} | 시장: {KOSPI/KOSDAQ}

## 요약

| 항목 | 값 |
|------|-----|
| 현재가 | {현재가}원 |
| 시가총액 | {시총}억원 (상위 {백분위}%) |
| PER | {PER} |
| PBR | {PBR} |
| 배당수익률 | {DIV}% |

## 1. 가격 동향

### 52주 가격 범위
- 최고가: {고가}원 ({날짜})
- 최저가: {저가}원 ({날짜})
- 현재 위치: 52주 범위 내 {위치}%

### 이동평균선
| 기간 | 가격 | 현재가 대비 |
|------|------|------------|
| 20일 | {MA20}원 | {대비}% |
| 60일 | {MA60}원 | {대비}% |
| 120일 | {MA120}원 | {대비}% |

## 2. 밸류에이션

| 지표 | 현재 | 의미 |
|------|------|------|
| PER | {PER} | 주가수익비율 |
| PBR | {PBR} | 주가순자산비율 |
| EPS | {EPS}원 | 주당순이익 |
| BPS | {BPS}원 | 주당순자산 |

## 3. 투자 판단

### 기술적 분석
- 추세: {상승/횡보/하락}
- 이평선 배열: {정배열/역배열}
- 현재 위치: {지지선/저항선 근처}

### 매수 타이밍
{분석 결과에 따른 상세 의견}

---

> 본 리포트는 quant-k 플러그인에 의해 자동 생성되었습니다.
> 투자 결정은 본인의 판단과 책임 하에 이루어져야 합니다.
```

## 에러 처리

| 상황 | 처리 |
|------|------|
| 종목명 미발견 | search 결과에서 유사 종목 제안 |
| pykrx 미설치 | `/quant-k:setup` 안내 |
| 데이터 없음 | 가능한 데이터만으로 부분 리포트 |
| 저장 경로 없음 | 디렉토리 자동 생성 |
