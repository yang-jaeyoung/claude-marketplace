---
name: ultra-analyze
description: KRX-Quant ìš¸íŠ¸ë¼ ë¶„ì„ ëª¨ë“œ. ëª¨ë“  ê¸°ëŠ¥ì„ ìµœëŒ€ ì—­ëŸ‰ìœ¼ë¡œ í™œìš©í•˜ì—¬ ì‹¬ì¸µ ë¶„ì„ ìˆ˜í–‰. "ìš¸íŠ¸ë¼ ë¶„ì„", "ultra", "ë”¥ ë¶„ì„", "ì „ì²´ ë¶„ì„" ë“±ì˜ ìš”ì²­ì— ìë™ í™œì„±í™”.
argument-hint: <ì¢…ëª©ëª…|ì¢…ëª©ì½”ë“œ> [ì €ì¥ê²½ë¡œ]
---

# KRX-Quant Ultra ë¶„ì„ ëª¨ë“œ

ëª¨ë“  quant-k ê¸°ëŠ¥ì„ ìµœëŒ€ ì—­ëŸ‰ìœ¼ë¡œ í™œìš©í•˜ì—¬ ì‹¬ì¸µ ì¢…í•©ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

## ì‚¬ì „ ìš”êµ¬ì‚¬í•­

Pythonê³¼ pykrxê°€ í•„ìš”í•©ë‹ˆë‹¤. ì²˜ìŒ ì‚¬ìš© ì‹œ `/quant-k:setup`ì„ ì‹¤í–‰í•˜ì„¸ìš”.

## ìë™ í™œì„±í™” íŒ¨í„´

ë‹¤ìŒ í‚¤ì›Œë“œê°€ í¬í•¨ëœ ìš”ì²­ì— ìë™ í™œì„±í™”ë©ë‹ˆë‹¤:

- `ìš¸íŠ¸ë¼`, `ultra`
- `ë”¥ ë¶„ì„`, `deep analysis`
- `ì „ì²´ ë¶„ì„`, `í’€ ë¶„ì„`
- `ì‹¬ì¸µ ë¶„ì„`, `ìµœëŒ€ ë¶„ì„`

**ì˜ˆì‹œ:**
```
"ë™ìš´ì•„ë‚˜í… ìš¸íŠ¸ë¼ ë¶„ì„í•´ì¤˜"
"ì‚¼ì„±ì „ì ultra ëª¨ë“œë¡œ ë¶„ì„"
"094170 ë”¥ ë¶„ì„í•´ì„œ report/ì— ì €ì¥"
```

## Ultra ëª¨ë“œ vs ì¼ë°˜ ëª¨ë“œ

| í•­ëª© | ì¼ë°˜ ëª¨ë“œ | Ultra ëª¨ë“œ |
|------|----------|-----------|
| ê°€ê²© ë°ì´í„° | 6ê°œì›” | 1ë…„ |
| ì´ë™í‰ê· ì„  | 20/60ì¼ | 5/10/20/60/120/240ì¼ |
| ê¸°ìˆ ì  ì§€í‘œ | ê¸°ë³¸ | RSI, MACD, ë³¼ë¦°ì €ë°´ë“œ |
| ìœ ì‚¬ ì¢…ëª© | 5ê°œ | 20ê°œ |
| ë¦¬í¬íŠ¸ ê¸¸ì´ | ìš”ì•½ | ìƒì„¸ (10+ ì„¹ì…˜) |

## ë°ì´í„° ìˆ˜ì§‘ ëª…ë ¹ì–´

### pykrx DataFrame ì»¬ëŸ¼ ë ˆí¼ëŸ°ìŠ¤

pykrxê°€ ë°˜í™˜í•˜ëŠ” DataFrameì˜ **ì‹¤ì œ ì»¬ëŸ¼ëª…**ì…ë‹ˆë‹¤. ì¸ë¼ì¸ Python ì½”ë“œì—ì„œ ë°˜ë“œì‹œ ì´ ì»¬ëŸ¼ëª…ì„ ì‚¬ìš©í•˜ì„¸ìš”.

**OHLCV (get_market_ohlcv):**
```python
['ì‹œê°€', 'ê³ ê°€', 'ì €ê°€', 'ì¢…ê°€', 'ê±°ë˜ëŸ‰', 'ë“±ë½ë¥ ']
# ì˜ë¬¸ ì—†ìŒ! 'ë“±ë½ë¥ 'ì€ ì „ì¼ëŒ€ë¹„ ë³€ë™ë¥  (%)
```

**Fundamental (get_market_fundamental):**
```python
['BPS', 'PER', 'PBR', 'EPS', 'DIV', 'DPS']
# ì˜ë¬¸ ëŒ€ë¬¸ìë§Œ ì‚¬ìš©
```

**Market Cap (get_market_cap):**
```python
['ì¢…ê°€', 'ì‹œê°€ì´ì•¡', 'ê±°ë˜ëŸ‰', 'ê±°ë˜ëŒ€ê¸ˆ', 'ìƒì¥ì£¼ì‹ìˆ˜']
# 'ì‹œê°€ì´ì•¡'ì€ ì› ë‹¨ìœ„ (ì–µì› ì•„ë‹˜)
```

**âš ï¸ ì£¼ì˜:** `ret_3m`, `momentum_3m`, `return_1m` ê°™ì€ ì»¬ëŸ¼ì€ **ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ëª¨ë©˜í…€ì€ ì§ì ‘ ê³„ì‚°í•´ì•¼ í•©ë‹ˆë‹¤:

```python
# 3ê°œì›” ìˆ˜ìµë¥  ê³„ì‚° ì˜ˆì‹œ
ohlcv = stock.get_market_ohlcv(start_date, end_date, ticker)
price_now = int(ohlcv['ì¢…ê°€'].iloc[-1])
price_3m = int(ohlcv['ì¢…ê°€'].iloc[0])
momentum_3m = round((price_now - price_3m) / price_3m * 100, 2)
```

### ë°©ì–´ì  ì½”ë”© íŒ¨í„´

pykrx APIëŠ” ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ ì‹œ **ë¹ˆ DataFrame**ì„ ë°˜í™˜í•©ë‹ˆë‹¤. í•­ìƒ í™•ì¸í•˜ì„¸ìš”:

```python
from pykrx import stock
import pandas as pd

# âŒ ì˜ëª»ëœ ì½”ë“œ - ë¹ˆ DataFrame ì‹œ KeyError ë°œìƒ
df = stock.get_market_fundamental(date, date, ticker)
per = df['PER'].iloc[0]  # KeyError if df is empty!

# âœ… ì˜¬ë°”ë¥¸ ì½”ë“œ - ë¹ˆ DataFrame ì²´í¬
df = stock.get_market_fundamental(date, date, ticker)
if df.empty:
    per = None
    print(f"Warning: No data for {ticker}")
else:
    per = float(df['PER'].iloc[0]) if pd.notna(df['PER'].iloc[0]) else None

# âœ… ë” ì•ˆì „í•œ íŒ¨í„´ - try/except
try:
    df = stock.get_market_fundamental(date, date, ticker)
    per = float(df['PER'].iloc[0]) if not df.empty and pd.notna(df['PER'].iloc[0]) else None
except Exception as e:
    print(f"Error fetching data: {e}")
    per = None
```

**ë¹ˆ ë°ì´í„° ë°œìƒ ì›ì¸:**
- íœ´ì¥ì¼/ê³µíœ´ì¼ ë‚ ì§œ ì¡°íšŒ
- ìƒì¥íì§€ëœ ì¢…ëª©ì½”ë“œ
- ì˜¤íƒ€ê°€ ìˆëŠ” ì¢…ëª©ì½”ë“œ
- pykrx ì„œë²„ ì¼ì‹œ ì˜¤ë¥˜

### ê¸°ë³¸ ìˆ˜ì§‘
```bash
# ì¢…ëª© í™•ì¸
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" search "ì¢…ëª©ëª…"
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" ticker_info "ì¢…ëª©ì½”ë“œ"

# 1ë…„ ê°€ê²© ë°ì´í„°
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" ohlcv "ì¢…ëª©ì½”ë“œ" --days 365

# í€ë”ë©˜í„¸
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" fundamental "ì¢…ëª©ì½”ë“œ"

# ì‹œê°€ì´ì•¡ ë° ìˆœìœ„
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" market_cap "ì¢…ëª©ì½”ë“œ"

# ì‹œì¥ ì „ì²´ ì¢…ëª© (ë¹„êµìš©)
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" market_tickers KOSPI
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" market_tickers KOSDAQ
```

### ë³‘ë ¬ ë°ì´í„° ìˆ˜ì§‘ (ê¶Œì¥)
```bash
# Phase 1 ë°ì´í„°ë¥¼ ë³‘ë ¬ë¡œ ìˆ˜ì§‘ (ohlcv + fundamental + market_cap ë™ì‹œ ì‹¤í–‰)
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" collect_all "ì¢…ëª©ì½”ë“œ" --days 365
```

ì´ ëª…ë ¹ì–´ëŠ” ohlcv, fundamental, market_capì„ ThreadPoolExecutorë¡œ ë™ì‹œì— ìˆ˜ì§‘í•˜ì—¬ 3ë°° ë¹ ë¦…ë‹ˆë‹¤.

## Ultra ë¶„ì„ ì›Œí¬í”Œë¡œìš° (ì—ì´ì „íŠ¸ ë³‘ë ¬ ì‹¤í–‰)

Ultra ëª¨ë“œëŠ” ì „ë¬¸ ì—ì´ì „íŠ¸ë¥¼ ë³‘ë ¬ë¡œ ì‹¤í–‰í•˜ì—¬ ë¶„ì„ ì†ë„ë¥¼ 3ë°° ì´ìƒ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

### âš ï¸ ì¤‘ìš”: ìŠ¤í‚¬ vs ì—ì´ì „íŠ¸ êµ¬ë¶„

**Task tool í˜¸ì¶œ ì‹œ ë°˜ë“œì‹œ ì—ì´ì „íŠ¸ ì´ë¦„ì„ ì‚¬ìš©í•˜ì„¸ìš”. ìŠ¤í‚¬ ì´ë¦„ì€ Task toolì—ì„œ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!**

| ìš©ë„ | âŒ ìŠ¤í‚¬ (ìŠ¬ë˜ì‹œ ëª…ë ¹ìš©) | âœ… ì—ì´ì „íŠ¸ (Task toolìš©) |
|------|-------------------------|---------------------------|
| íŒ©í„° ë¶„ì„ | `quant-k:factor-analyze` | **`quant-k:quant-analyst`** |
| ì¢…ëª© ìŠ¤í¬ë¦¬ë‹ | `quant-k:stock-screen` | **`quant-k:stock-screener`** |
| ì›¹ ìŠ¤í¬ë˜í•‘ | `quant-k:browser-scraper` | **`quant-k:web-scraper`** |

**ì™œ ì¤‘ìš”í•œê°€?**
- ìŠ¤í‚¬(`/quant-k:factor-analyze`)ì€ ëŒ€í™”í˜• ëª…ë ¹ìœ¼ë¡œ, ì‚¬ìš©ìê°€ ì§ì ‘ ì‹¤í–‰
- ì—ì´ì „íŠ¸(`quant-k:quant-analyst`)ëŠ” Task toolì˜ `subagent_type`ìœ¼ë¡œ ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥
- ìŠ¤í‚¬ ì´ë¦„ì„ `subagent_type`ì— ì‚¬ìš©í•˜ë©´ **ì¦‰ì‹œ ì¢…ë£Œë˜ì–´ ì‘ì—…ì´ ìˆ˜í–‰ë˜ì§€ ì•ŠìŒ**

### ì—ì´ì „íŠ¸ êµ¬ì„±

| ì—ì´ì „íŠ¸ | ì—­í•  | Phase |
|----------|------|-------|
| `quant-k:web-scraper` | ì™¸ë¶€ ë°ì´í„° ìˆ˜ì§‘ (ë„¤ì´ë²„/DART) | Phase 2 |
| `quant-k:quant-analyst` | íŒ©í„° ë¶„ì„, ë°¸ë¥˜ì—ì´ì…˜ | Phase 3 |
| `quant-k:stock-screener` | ìœ ì‚¬ ì¢…ëª© ê²€ìƒ‰ | Phase 4 |

---

## ğŸ“¥ ë°ì´í„° ìˆ˜ì§‘ ë‹¨ê³„

### Phase 1: KRX ê¸°ë³¸ ë°ì´í„° ìˆ˜ì§‘

**ê¶Œì¥: collect_allë¡œ ë³‘ë ¬ ìˆ˜ì§‘**
```bash
python3 "${CLAUDE_PLUGIN_ROOT}/scripts/krx_utils.py" collect_all "ì¢…ëª©ì½”ë“œ" --days 365
```

ìœ„ ëª…ë ¹ í•˜ë‚˜ë¡œ ohlcv, fundamental, market_capì„ ë³‘ë ¬ ìˆ˜ì§‘í•©ë‹ˆë‹¤.

### Phase 2: ì›¹ ìŠ¤í¬ë˜í•‘ (ì™¸ë¶€ ë°ì´í„°)

```
Task(
  subagent_type="quant-k:web-scraper",
  model="sonnet",
  prompt="ë„¤ì´ë²„ ê¸ˆìœµì—ì„œ {ì¢…ëª©ì½”ë“œ} ì¶”ê°€ ì •ë³´ ìˆ˜ì§‘: íˆ¬ìì˜ê²¬, ëª©í‘œê°€, ë‰´ìŠ¤ í—¤ë“œë¼ì¸"
)
```

---

## ğŸ“Š ì‹¬ì¸µ ë¶„ì„ ë‹¨ê³„

### Phase 3: ì „ì²´ íŒ©í„° ë¶„ì„

```
Task(
  subagent_type="quant-k:quant-analyst",
  model="sonnet",
  prompt="""
  ë‹¤ìŒ ì¢…ëª©ì˜ í€€íŠ¸ íŒ©í„° ë¶„ì„ì„ ìˆ˜í–‰í•˜ì„¸ìš”:
  - ì¢…ëª©: {ì¢…ëª©ëª…} ({ì¢…ëª©ì½”ë“œ})
  - ìˆ˜ì§‘ëœ ë°ì´í„°: {Phase 1-2 ê²°ê³¼}

  ë¶„ì„ í•­ëª©:
  1. PER/PBR ë°¸ë¥˜ì—ì´ì…˜ í‰ê°€
  2. 3/6/12ê°œì›” ëª¨ë©˜í…€ ê³„ì‚°
  3. ì ì •ê°€ ì‚°ì¶œ (PER/PBR ê¸°ë°˜)
  4. íˆ¬ì ìŠ¤ì½”ì–´ì¹´ë“œ ì‘ì„±
  """
)
```

### Phase 4: í™•ì¥ ìŠ¤í¬ë¦¬ë‹ (ìœ ì‚¬ ì¢…ëª©)

```
Task(
  subagent_type="quant-k:stock-screener",
  model="sonnet",
  prompt="ì‹œì¥ì—ì„œ ìœ ì‚¬í•œ ë°¸ë¥˜ì—ì´ì…˜ì„ ê°€ì§„ ì¢…ëª© 20ê°œë¥¼ ì°¾ì•„ì£¼ì„¸ìš”. ì¡°ê±´: PER Â±30%, PBR Â±30%, ë™ì¼ ì‹œì¥"
)
```

### Phase 5: ê³ ê¸‰ ê¸°ìˆ ë¶„ì„

- ì´ë™í‰ê· ì„  ë¶„ì„ (5/10/20/60/120/240ì¼)
- RSI, MACD
- ë³¼ë¦°ì €ë°´ë“œ
- ì§€ì§€/ì €í•­ì„  ë¶„ì„

---

## ğŸ“ ë¦¬í¬íŠ¸ ë‹¨ê³„

### Phase 6: Ultra ë¦¬í¬íŠ¸ í†µí•©

ëª¨ë“  ì—ì´ì „íŠ¸ ê²°ê³¼ë¥¼ í†µí•©í•˜ì—¬ Ultra ë¦¬í¬íŠ¸ ìƒì„±

### ìˆœì°¨ ì‹¤í–‰ vs ë³‘ë ¬ ì‹¤í–‰

| ë°©ì‹ | Phase 1-2 | Phase 3-4 | Phase 5-6 | ì´ ì‹œê°„ |
|------|-----------|-----------|-----------|---------|
| ìˆœì°¨ ì‹¤í–‰ | 30ì´ˆ | 60ì´ˆ | 30ì´ˆ | ~120ì´ˆ |
| ë³‘ë ¬ ì‹¤í–‰ | 10ì´ˆ | 20ì´ˆ | 15ì´ˆ | ~45ì´ˆ |

**âš ï¸ ì£¼ì˜:** ì—ì´ì „íŠ¸ ë³‘ë ¬ ì‹¤í–‰ ì‹œ ë™ì¼ íŒŒì¼ ìˆ˜ì • ê¸ˆì§€ (race condition ë°©ì§€)

## ë¦¬í¬íŠ¸ êµ¬ì¡°

```markdown
# {ì¢…ëª©ëª…} ({ì¢…ëª©ì½”ë“œ}) Ultra ë¶„ì„ ë¦¬í¬íŠ¸

> ìƒì„±ì¼: {ë‚ ì§œ} | ë¶„ì„ ëª¨ë“œ: ULTRA

---

## Executive Summary
{í•µì‹¬ ìš”ì•½ 3-5ë¬¸ì¥}

## íˆ¬ì ìŠ¤ì½”ì–´ì¹´ë“œ
| í•­ëª© | ì ìˆ˜ | ë“±ê¸‰ |
|------|------|------|
| ë°¸ë¥˜ì—ì´ì…˜ | {1-10} | {A-F} |
| ëª¨ë©˜í…€ | {1-10} | {A-F} |
| ì•ˆì •ì„± | {1-10} | {A-F} |
| **ì¢…í•©** | **{1-10}** | **{A-F}** |

---

## Part 1: ê¸°ì—… ê°œìš”
- ì¢…ëª©ëª…, ì¢…ëª©ì½”ë“œ, ì‹œì¥
- ì‹œê°€ì´ì•¡ ë° ìˆœìœ„

## Part 2: ì£¼ê°€ ë¶„ì„ (1ë…„)
- 52ì£¼ ê³ ê°€/ì €ê°€
- ìˆ˜ìµë¥  ë¶„ì„ (1M/3M/6M/12M)
- ë³€ë™ì„± ë¶„ì„

## Part 3: ê¸°ìˆ ì  ë¶„ì„
- ì´ë™í‰ê· ì„  ë¶„ì„ (6ê°œ)
- ë³¼ë¦°ì €ë°´ë“œ
- RSI, MACD
- ì§€ì§€/ì €í•­ì„ 

## Part 4: ë°¸ë¥˜ì—ì´ì…˜ ë¶„ì„
- PER/PBR/EPS/BPS ìƒì„¸
- ì ì •ê°€ ì‚°ì¶œ

## Part 5: ìœ ì‚¬ ì¢…ëª© ë¹„êµ
- ì‹œì´ ìœ ì‚¬ ì¢…ëª©
- ë°¸ë¥˜ì—ì´ì…˜ ìœ ì‚¬ ì¢…ëª©

## Part 6: íˆ¬ì ì „ëµ
- ë§¤ìˆ˜ íƒ€ì´ë° ë¶„ì„
- ëª©í‘œê°€/ì†ì ˆê°€
- ë¦¬ìŠ¤í¬ ìš”ì¸

## Part 7: ê²°ë¡ 
- ê°•ì /ì•½ì  ìš”ì•½
- ìµœì¢… íˆ¬ìì˜ê²¬

---

> ë³¸ ë¦¬í¬íŠ¸ëŠ” quant-k Ultra ëª¨ë“œì— ì˜í•´ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
```

## ì¶œë ¥ íŒŒì¼ êµ¬ì¡°

Ultra ëª¨ë“œëŠ” ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¡œ ì¶œë ¥:

```
{ì €ì¥ê²½ë¡œ}/{ì¢…ëª©ëª…}_ultra_{ë‚ ì§œ}/
â”œâ”€â”€ README.md                    # ë©”ì¸ ë¦¬í¬íŠ¸
â”œâ”€â”€ data/
â”‚   â””â”€â”€ ohlcv.csv               # ê°€ê²© ë°ì´í„°
â””â”€â”€ analysis/
    â”œâ”€â”€ technical.md            # ê¸°ìˆ ì  ë¶„ì„
    â””â”€â”€ valuation.md            # ë°¸ë¥˜ì—ì´ì…˜ ë¶„ì„
```

## âš ï¸ ì¶œë ¥ ê²½ë¡œ ê·œì¹™ (í•„ìˆ˜)

**ëª¨ë“  íŒŒì¼ì€ ë°˜ë“œì‹œ ì‚¬ìš©ìê°€ ì§€ì •í•œ ì €ì¥ê²½ë¡œ ì•„ë˜ì—ë§Œ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.**

```
âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ (ì €ì¥ê²½ë¡œ: report/lnk)
report/lnk/
â”œâ”€â”€ data/ohlcv.csv
â”œâ”€â”€ analysis/technical.md
â”œâ”€â”€ scripts/analysis.py
â””â”€â”€ README.md

âŒ ì˜ëª»ëœ ì˜ˆì‹œ (í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— íŒŒì¼ ìƒì„±)
./data/           â† ê¸ˆì§€!
./scripts/        â† ê¸ˆì§€!
./docs/           â† ê¸ˆì§€!
./PROJECT_STATUS.txt  â† ê¸ˆì§€!
```

**ì—ì´ì „íŠ¸ ì‹¤í–‰ ì‹œ ê·œì¹™:**
1. ì €ì¥ê²½ë¡œê°€ ì§€ì •ë˜ë©´, ëª¨ë“  ì¤‘ê°„ íŒŒì¼(data, scripts, docs)ë„ í•´ë‹¹ ê²½ë¡œ ì•„ë˜ì— ìƒì„±
2. ì €ì¥ê²½ë¡œê°€ ë¯¸ì§€ì •ì´ë©´, í˜„ì¬ ë””ë ‰í† ë¦¬ì— `{ì¢…ëª©ëª…}_ultra_{ë‚ ì§œ}/` ë””ë ‰í† ë¦¬ ìƒì„± í›„ ê·¸ ì•ˆì— ëª¨ë“  íŒŒì¼ ì €ì¥
3. **ì ˆëŒ€ë¡œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ì§ì ‘ íŒŒì¼ì„ ìƒì„±í•˜ì§€ ì•ŠìŒ**
4. ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ìë™ ìƒì„± (`mkdir -p`)

## ì‚¬ìš©ë²•

### ëª…ë ¹ì–´
```bash
/quant-k:ultra-analyze ë™ìš´ì•„ë‚˜í…
/quant-k:ultra-analyze 094170 report/
```

### ìì—°ì–´
```
"ë™ìš´ì•„ë‚˜í… ìš¸íŠ¸ë¼ ë¶„ì„í•´ì¤˜"
"ì‚¼ì„±ì „ì ultra ëª¨ë“œë¡œ ì „ì²´ ë¶„ì„"
"SKí•˜ì´ë‹‰ìŠ¤ ì‹¬ì¸µ ë¶„ì„ ë¦¬í¬íŠ¸ ë§Œë“¤ì–´ì¤˜"
```

## ì£¼ì˜: JSON ì§ë ¬í™”

ë¶„ì„ ê²°ê³¼ë¥¼ JSONìœ¼ë¡œ ì €ì¥í•  ë•Œ numpy/pandas íƒ€ì…ì€ ì§ë ¬í™” ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.

**ì•ˆì „í•œ JSON ì €ì¥ íŒ¨í„´:**
```python
import json
import numpy as np

def safe_json_value(v):
    """numpy íƒ€ì…ì„ Python ë„¤ì´í‹°ë¸Œ íƒ€ì…ìœ¼ë¡œ ë³€í™˜"""
    if isinstance(v, (np.integer, np.int64)):
        return int(v)
    elif isinstance(v, (np.floating, np.float64)):
        return float(v)
    elif isinstance(v, np.ndarray):
        return v.tolist()
    elif pd.isna(v):
        return None
    return v

def safe_dict(d):
    """ë”•ì…”ë„ˆë¦¬ì˜ ëª¨ë“  ê°’ì„ ì•ˆì „í•˜ê²Œ ë³€í™˜"""
    return {k: safe_json_value(v) for k, v in d.items()}

# ì‚¬ìš© ì˜ˆì‹œ
result = safe_dict({"per": df['PER'].iloc[0], "price": ohlcv['ì¢…ê°€'].iloc[-1]})
json.dump(result, f, ensure_ascii=False)
```

**ë˜ëŠ” ê°„ë‹¨íˆ:**
```python
# ëª¨ë“  ìˆ«ìë¥¼ float()ë¡œ ë³€í™˜
result = {
    "per": float(per) if per else None,
    "price": int(price),
}
```

## WebFetch ì°¨ë‹¨ ì‚¬ì´íŠ¸ ì²˜ë¦¬

ì¼ë¶€ ê¸ˆìœµ ì‚¬ì´íŠ¸(ì˜ˆ: `finance.naver.com`, `dart.fss.or.kr`)ëŠ” WebFetchë¡œ ì ‘ê·¼ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤.

**ì°¨ë‹¨ëœ ì‚¬ì´íŠ¸ì—ì„œ ë°ì´í„°ê°€ í•„ìš”í•œ ê²½ìš°:**

browser-scraper ìŠ¤í‚¬ì„ ì‚¬ìš©í•˜ì„¸ìš”:

```bash
# ë„¤ì´ë²„ ê¸ˆìœµ ì‹œê°€ì´ì•¡ ìˆœìœ„
/quant-k:browser-scraper https://finance.naver.com/sise/sise_market_sum.naver "ì‹œê°€ì´ì•¡ ìƒìœ„ 100ê°œ"

# ë„¤ì´ë²„ ê¸ˆìœµ ì¢…ëª© ìƒì„¸
/quant-k:browser-scraper https://finance.naver.com/item/main.naver?code={ì¢…ëª©ì½”ë“œ} "ê¸°ì—… ì •ë³´"

# DART ê³µì‹œ ê²€ìƒ‰
/quant-k:browser-scraper AUTO: https://dart.fss.or.kr "ìµœê·¼ ê³µì‹œ"

# KRX ë°ì´í„° í¬í„¸ (API ìë™ íƒì§€)
/quant-k:browser-scraper https://data.krx.co.kr --discover-api "ì¢…ëª©ë³„ ì‹œì„¸"
```

**browser-scraper vs WebFetch:**

| ë„êµ¬ | ì¥ì  | ë‹¨ì  | ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ |
|------|------|------|--------------|
| WebFetch | ë¹ ë¦„, ê°„ë‹¨ | ì¼ë¶€ ì‚¬ì´íŠ¸ ì°¨ë‹¨ | ê³µê°œ API, í—ˆìš©ëœ ì‚¬ì´íŠ¸ |
| browser-scraper | ì°¨ë‹¨ ìš°íšŒ, JS ë Œë”ë§ | ëŠë¦¼, ë³µì¡ | ë„¤ì´ë²„, DART, KRX ë“± |

**ê¶Œì¥ ì›Œí¬í”Œë¡œìš°:**
1. ë¨¼ì € pykrxë¡œ ê¸°ë³¸ ë°ì´í„° ìˆ˜ì§‘ (`collect_all`)
2. ì¶”ê°€ ì •ë³´ í•„ìš” ì‹œ browser-scraperë¡œ ë„¤ì´ë²„/DART ìŠ¤í¬ë˜í•‘
3. ê²°ê³¼ í†µí•©í•˜ì—¬ ë¦¬í¬íŠ¸ ìƒì„±

## ì—ëŸ¬ ì²˜ë¦¬

| ìƒí™© | ì²˜ë¦¬ |
|------|------|
| pykrx ë¯¸ì„¤ì¹˜ | `/quant-k:setup` ì•ˆë‚´ |
| ë°ì´í„° ë¶€ì¡± | ê°€ëŠ¥í•œ ë°ì´í„°ë§Œìœ¼ë¡œ ë¶€ë¶„ ë¦¬í¬íŠ¸ |
| 1ë…„ ë°ì´í„° ì—†ìŒ | ê°€ìš© ê¸°ê°„ìœ¼ë¡œ ì¶•ì†Œ |
| ì €ì¥ ì‹¤íŒ¨ | ì½˜ì†”ì— ì „ì²´ ì¶œë ¥ |
