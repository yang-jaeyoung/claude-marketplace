{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "research-orchestrator/output",
  "title": "Research Orchestrator Output Schema",
  "description": "연구 오케스트레이터 출력 데이터 스키마",
  "type": "object",
  "required": ["meta", "research", "stages", "validation", "synthesis"],
  "properties": {
    "meta": {
      "type": "object",
      "description": "메타데이터",
      "required": ["generated_at", "skill_version", "research_goal", "research_depth"],
      "properties": {
        "generated_at": {
          "type": "string",
          "format": "date-time",
          "description": "생성 시간"
        },
        "skill_version": {
          "type": "string",
          "description": "스킬 버전"
        },
        "research_goal": {
          "type": "string",
          "description": "연구 목표"
        },
        "research_depth": {
          "type": "string",
          "enum": ["quick", "standard", "deep"],
          "description": "연구 깊이"
        },
        "research_type": {
          "type": "string",
          "enum": ["technical", "academic", "market", "comparative", "exploratory"],
          "description": "연구 유형"
        },
        "execution_mode": {
          "type": "string",
          "enum": ["interactive", "auto"],
          "description": "실행 모드"
        },
        "total_execution_time_minutes": {
          "type": "number",
          "description": "총 실행 시간 (분)"
        },
        "language": {
          "type": "string",
          "enum": ["ko", "en"],
          "description": "결과 언어"
        }
      }
    },
    "research": {
      "type": "object",
      "description": "연구 개요",
      "required": ["goal", "scope", "methodology"],
      "properties": {
        "goal": {
          "type": "string",
          "description": "연구 목표 상세"
        },
        "scope": {
          "type": "object",
          "description": "연구 범위",
          "properties": {
            "included": {
              "type": "array",
              "items": { "type": "string" },
              "description": "포함된 영역"
            },
            "excluded": {
              "type": "array",
              "items": { "type": "string" },
              "description": "제외된 영역"
            }
          }
        },
        "methodology": {
          "type": "object",
          "description": "연구 방법론",
          "properties": {
            "approach": {
              "type": "string",
              "description": "접근 방식"
            },
            "data_sources": {
              "type": "array",
              "items": { "type": "string" },
              "description": "데이터 소스"
            },
            "validation_method": {
              "type": "string",
              "description": "검증 방법"
            }
          }
        },
        "initial_hypotheses": {
          "type": "array",
          "items": { "type": "string" },
          "description": "초기 가설"
        }
      }
    },
    "decomposition": {
      "type": "object",
      "description": "연구 분해 결과",
      "required": ["total_stages", "stages_overview"],
      "properties": {
        "total_stages": {
          "type": "integer",
          "minimum": 1,
          "description": "총 단계 수"
        },
        "stages_overview": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["stage_id", "name", "objective"],
            "properties": {
              "stage_id": {
                "type": "integer",
                "description": "단계 ID"
              },
              "name": {
                "type": "string",
                "description": "단계 이름"
              },
              "objective": {
                "type": "string",
                "description": "단계 목적"
              },
              "dependencies": {
                "type": "array",
                "items": { "type": "integer" },
                "description": "의존하는 단계 ID 목록"
              },
              "parallel_group": {
                "type": "integer",
                "description": "병렬 실행 그룹 ID"
              }
            }
          },
          "description": "단계 개요 목록"
        },
        "execution_order": {
          "type": "array",
          "items": {
            "type": "array",
            "items": { "type": "integer" }
          },
          "description": "실행 순서 (병렬 그룹별)"
        }
      }
    },
    "stages": {
      "type": "array",
      "description": "각 단계 상세 결과",
      "items": {
        "type": "object",
        "required": ["stage_id", "name", "status", "findings"],
        "properties": {
          "stage_id": {
            "type": "integer",
            "description": "단계 ID"
          },
          "name": {
            "type": "string",
            "description": "단계 이름"
          },
          "status": {
            "type": "string",
            "enum": ["completed", "partial", "failed", "skipped"],
            "description": "완료 상태"
          },
          "execution_time_minutes": {
            "type": "number",
            "description": "실행 시간 (분)"
          },
          "objective": {
            "type": "string",
            "description": "단계 목적"
          },
          "questions_addressed": {
            "type": "array",
            "items": { "type": "string" },
            "description": "다룬 질문들"
          },
          "findings": {
            "type": "array",
            "items": {
              "$ref": "#/definitions/finding"
            },
            "description": "발견 목록"
          },
          "uncertainties": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "topic": { "type": "string" },
                "description": { "type": "string" },
                "impact": {
                  "type": "string",
                  "enum": ["low", "medium", "high"]
                }
              }
            },
            "description": "불확실성 목록"
          },
          "sources": {
            "type": "array",
            "items": {
              "$ref": "#/definitions/source"
            },
            "description": "출처 목록"
          }
        }
      }
    },
    "validation": {
      "type": "object",
      "description": "교차 검증 결과",
      "required": ["performed", "consistency_score"],
      "properties": {
        "performed": {
          "type": "boolean",
          "description": "검증 수행 여부"
        },
        "consistency_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "일관성 점수 (0-1)"
        },
        "validated_findings": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "finding_id": { "type": "string" },
              "validation_status": {
                "type": "string",
                "enum": ["confirmed", "partially_confirmed", "contradicted", "unverified"]
              },
              "supporting_stages": {
                "type": "array",
                "items": { "type": "integer" }
              },
              "contradicting_stages": {
                "type": "array",
                "items": { "type": "integer" }
              },
              "final_confidence": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              }
            }
          },
          "description": "검증된 발견 목록"
        },
        "contradictions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "description": { "type": "string" },
              "stages_involved": {
                "type": "array",
                "items": { "type": "integer" }
              },
              "resolution": { "type": "string" },
              "resolved": { "type": "boolean" }
            }
          },
          "description": "발견된 모순 목록"
        },
        "gaps": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "area": { "type": "string" },
              "description": { "type": "string" },
              "severity": {
                "type": "string",
                "enum": ["minor", "moderate", "significant"]
              }
            }
          },
          "description": "발견된 갭 목록"
        }
      }
    },
    "synthesis": {
      "type": "object",
      "description": "종합 결과",
      "required": ["summary", "key_findings", "conclusions"],
      "properties": {
        "summary": {
          "type": "string",
          "description": "연구 요약 (Executive Summary)"
        },
        "key_findings": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "finding", "confidence"],
            "properties": {
              "id": { "type": "string" },
              "finding": { "type": "string" },
              "confidence": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              },
              "supporting_evidence": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          },
          "description": "핵심 발견 목록"
        },
        "patterns": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "pattern": { "type": "string" },
              "description": { "type": "string" },
              "relevance": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              }
            }
          },
          "description": "발견된 패턴"
        },
        "conclusions": {
          "type": "array",
          "items": { "type": "string" },
          "description": "결론 목록"
        },
        "recommendations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "recommendation": { "type": "string" },
              "priority": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              },
              "rationale": { "type": "string" }
            }
          },
          "description": "권장사항"
        },
        "limitations": {
          "type": "array",
          "items": { "type": "string" },
          "description": "연구 한계점"
        },
        "future_research": {
          "type": "array",
          "items": { "type": "string" },
          "description": "후속 연구 제안"
        }
      }
    },
    "references": {
      "type": "array",
      "description": "전체 참고 자료",
      "items": {
        "$ref": "#/definitions/source"
      }
    },
    "execution_stats": {
      "type": "object",
      "description": "실행 통계",
      "properties": {
        "total_stages": {
          "type": "integer",
          "description": "총 Stage 수"
        },
        "completed_stages": {
          "type": "integer",
          "description": "완료된 Stage 수"
        },
        "failed_stages": {
          "type": "integer",
          "description": "실패한 Stage 수"
        },
        "skipped_stages": {
          "type": "integer",
          "description": "스킵된 Stage 수"
        },
        "total_findings": {
          "type": "integer",
          "description": "총 Finding 수"
        },
        "total_sources": {
          "type": "integer",
          "description": "총 출처 수"
        },
        "total_execution_time": {
          "type": "integer",
          "description": "총 실행 시간 (초)"
        },
        "start_time": {
          "type": "string",
          "format": "date-time",
          "description": "시작 시간"
        },
        "end_time": {
          "type": "string",
          "format": "date-time",
          "description": "종료 시간"
        }
      }
    }
  },
  "definitions": {
    "finding": {
      "type": "object",
      "required": ["id", "topic", "summary", "confidence"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^F\\d+-\\d{3}$",
          "description": "발견 ID (예: F1-001)"
        },
        "topic": {
          "type": "string",
          "description": "주제"
        },
        "summary": {
          "type": "string",
          "description": "요약"
        },
        "details": {
          "type": "string",
          "description": "상세 내용"
        },
        "evidence": {
          "type": "array",
          "items": { "type": "string" },
          "description": "증거"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "신뢰도 (0-1)"
        },
        "source_refs": {
          "type": "array",
          "items": { "type": "string" },
          "description": "출처 참조"
        }
      }
    },
    "source": {
      "type": "object",
      "required": ["id", "type", "title"],
      "properties": {
        "id": {
          "type": "string",
          "description": "출처 ID"
        },
        "type": {
          "type": "string",
          "enum": ["web", "documentation", "paper", "book", "repository", "other"],
          "description": "출처 유형"
        },
        "title": {
          "type": "string",
          "description": "제목"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "URL"
        },
        "author": {
          "type": "string",
          "description": "저자"
        },
        "date": {
          "type": "string",
          "description": "날짜"
        },
        "accessed_at": {
          "type": "string",
          "format": "date-time",
          "description": "접근 시간"
        },
        "reliability": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "description": "신뢰도"
        }
      }
    }
  }
}
