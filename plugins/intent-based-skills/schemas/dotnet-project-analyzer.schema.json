{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "dotnet-project-analyzer/output",
  "title": ".NET Project Analyzer Output Schema",
  "description": ".NET 솔루션 분석 결과 데이터 스키마",
  "type": "object",
  "required": ["meta", "solution", "projects", "dependencies", "architecture"],
  "properties": {
    "meta": {
      "type": "object",
      "description": "분석 메타데이터",
      "required": ["generated_at", "skill_version", "solution_path"],
      "properties": {
        "generated_at": {
          "type": "string",
          "format": "date-time",
          "description": "분석 생성 시간 (ISO 8601)"
        },
        "skill_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "스킬 버전"
        },
        "solution_path": {
          "type": "string",
          "description": "분석된 솔루션 파일 경로"
        },
        "analysis_options": {
          "type": "object",
          "description": "분석 옵션",
          "properties": {
            "check_nuget_updates": {
              "type": "boolean",
              "default": false
            },
            "include_test_projects": {
              "type": "boolean",
              "default": true
            },
            "architecture_patterns": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["clean-architecture", "onion-architecture", "n-tier", "cqrs"]
              }
            }
          }
        }
      }
    },
    "solution": {
      "type": "object",
      "description": "솔루션 정보",
      "required": ["name", "format"],
      "properties": {
        "name": {
          "type": "string",
          "description": "솔루션 이름"
        },
        "format": {
          "type": "string",
          "enum": [".sln", ".slnx"],
          "description": "솔루션 파일 형식"
        },
        "sdk_version": {
          "type": "string",
          "description": "주요 SDK 버전 (예: net10.0)"
        },
        "folders": {
          "type": "array",
          "description": "솔루션 폴더 구조",
          "items": {
            "type": "object",
            "required": ["name", "projects"],
            "properties": {
              "name": {
                "type": "string",
                "description": "폴더 이름 (예: /Domain/)"
              },
              "projects": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "폴더 내 프로젝트 경로 목록"
              }
            }
          }
        }
      }
    },
    "projects": {
      "type": "array",
      "description": "프로젝트 목록",
      "items": {
        "type": "object",
        "required": ["name", "path", "layer"],
        "properties": {
          "name": {
            "type": "string",
            "description": "프로젝트 이름"
          },
          "path": {
            "type": "string",
            "description": "프로젝트 파일 상대 경로"
          },
          "targetFramework": {
            "type": "string",
            "description": "대상 프레임워크 (예: net10.0)"
          },
          "sdk": {
            "type": "string",
            "description": "SDK 유형 (예: Microsoft.NET.Sdk.Web)"
          },
          "assemblyName": {
            "type": "string",
            "description": "어셈블리 이름"
          },
          "layer": {
            "type": "string",
            "enum": ["Domain", "Application", "Infrastructure", "Presentation", "Contracts", "Tests", "Unclassified"],
            "description": "Clean Architecture 레이어 분류"
          },
          "solutionFolder": {
            "type": "string",
            "description": "솔루션 폴더 (있는 경우)"
          },
          "projectReferences": {
            "type": "array",
            "description": "프로젝트 참조 목록",
            "items": {
              "type": "object",
              "required": ["name", "path"],
              "properties": {
                "name": {
                  "type": "string",
                  "description": "참조 프로젝트 이름"
                },
                "path": {
                  "type": "string",
                  "description": "참조 프로젝트 경로"
                }
              }
            }
          },
          "packageReferences": {
            "type": "array",
            "description": "NuGet 패키지 참조 목록",
            "items": {
              "type": "object",
              "required": ["name", "version"],
              "properties": {
                "name": {
                  "type": "string",
                  "description": "패키지 이름"
                },
                "version": {
                  "type": "string",
                  "description": "패키지 버전"
                },
                "privateAssets": {
                  "type": "string",
                  "description": "PrivateAssets 설정"
                },
                "includeAssets": {
                  "type": "string",
                  "description": "IncludeAssets 설정"
                }
              }
            }
          },
          "metrics": {
            "type": "object",
            "description": "프로젝트 메트릭스",
            "properties": {
              "fileCount": {
                "type": "integer",
                "description": "소스 파일 수"
              },
              "classCount": {
                "type": "integer",
                "description": "클래스 수"
              },
              "interfaceCount": {
                "type": "integer",
                "description": "인터페이스 수"
              },
              "linesOfCode": {
                "type": "integer",
                "description": "코드 라인 수 (추정)"
              }
            }
          }
        }
      }
    },
    "dependencies": {
      "type": "object",
      "description": "의존성 분석 결과",
      "required": ["graph"],
      "properties": {
        "graph": {
          "type": "object",
          "description": "의존성 그래프 (인접 리스트)",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "프로젝트가 참조하는 다른 프로젝트 목록"
          }
        },
        "circular_references": {
          "type": "array",
          "description": "순환 참조 목록",
          "items": {
            "type": "object",
            "required": ["cycle"],
            "properties": {
              "cycle": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "순환 참조 경로 (예: [A, B, C, A])"
              },
              "severity": {
                "type": "string",
                "enum": ["critical", "warning"],
                "default": "critical"
              }
            }
          }
        },
        "dependency_depth": {
          "type": "object",
          "description": "각 프로젝트의 의존성 깊이",
          "additionalProperties": {
            "type": "integer"
          }
        }
      }
    },
    "architecture": {
      "type": "object",
      "description": "아키텍처 분석 결과",
      "required": ["layers"],
      "properties": {
        "layers": {
          "type": "object",
          "description": "레이어별 프로젝트 분류",
          "properties": {
            "Domain": {
              "type": "array",
              "items": { "type": "string" }
            },
            "Application": {
              "type": "array",
              "items": { "type": "string" }
            },
            "Infrastructure": {
              "type": "array",
              "items": { "type": "string" }
            },
            "Presentation": {
              "type": "array",
              "items": { "type": "string" }
            },
            "Contracts": {
              "type": "array",
              "items": { "type": "string" }
            },
            "Tests": {
              "type": "array",
              "items": { "type": "string" }
            },
            "Unclassified": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "violations": {
          "type": "array",
          "description": "아키텍처 위반 사항",
          "items": {
            "type": "object",
            "required": ["type", "source", "target", "severity"],
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "domain-external-dependency",
                  "reverse-dependency",
                  "circular-reference",
                  "application-infrastructure-direct"
                ],
                "description": "위반 유형"
              },
              "source": {
                "type": "string",
                "description": "위반을 발생시킨 프로젝트"
              },
              "target": {
                "type": "string",
                "description": "잘못된 참조 대상 프로젝트"
              },
              "severity": {
                "type": "string",
                "enum": ["critical", "warning", "info"],
                "description": "심각도"
              },
              "description": {
                "type": "string",
                "description": "위반 설명"
              },
              "recommendation": {
                "type": "string",
                "description": "권장 수정 방법"
              }
            }
          }
        },
        "cqrs_detected": {
          "type": "boolean",
          "description": "CQRS 패턴 사용 여부"
        },
        "cqrs_details": {
          "type": "object",
          "description": "CQRS 패턴 상세",
          "properties": {
            "query_repositories": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Query Repository 목록"
            },
            "command_repositories": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Command Repository 목록"
            },
            "query_orm": {
              "type": "string",
              "description": "Query에 사용된 ORM (예: Dapper)"
            },
            "command_orm": {
              "type": "string",
              "description": "Command에 사용된 ORM (예: EF Core)"
            }
          }
        },
        "clean_architecture_compliance": {
          "type": "object",
          "description": "Clean Architecture 준수 점수",
          "properties": {
            "score": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "준수 점수 (0-100)"
            },
            "details": {
              "type": "string",
              "description": "상세 설명"
            }
          }
        }
      }
    },
    "nuget": {
      "type": "object",
      "description": "NuGet 패키지 분석 결과",
      "properties": {
        "total_packages": {
          "type": "integer",
          "description": "고유 패키지 총 개수"
        },
        "packages": {
          "type": "array",
          "description": "패키지 상세 목록",
          "items": {
            "type": "object",
            "required": ["name", "usages"],
            "properties": {
              "name": {
                "type": "string",
                "description": "패키지 이름"
              },
              "usages": {
                "type": "array",
                "description": "패키지 사용 현황",
                "items": {
                  "type": "object",
                  "required": ["project", "version"],
                  "properties": {
                    "project": {
                      "type": "string",
                      "description": "프로젝트 이름"
                    },
                    "version": {
                      "type": "string",
                      "description": "사용 버전"
                    }
                  }
                }
              },
              "latestVersion": {
                "type": "string",
                "description": "최신 버전 (check_nuget_updates=true 시)"
              },
              "hasUpdate": {
                "type": "boolean",
                "description": "업데이트 가능 여부"
              }
            }
          }
        },
        "version_mismatches": {
          "type": "array",
          "description": "버전 불일치 패키지 목록",
          "items": {
            "type": "object",
            "required": ["package", "versions"],
            "properties": {
              "package": {
                "type": "string",
                "description": "패키지 이름"
              },
              "versions": {
                "type": "array",
                "description": "사용 중인 버전 목록",
                "items": {
                  "type": "object",
                  "required": ["version", "projects"],
                  "properties": {
                    "version": {
                      "type": "string"
                    },
                    "projects": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                }
              }
            }
          }
        },
        "deprecated_packages": {
          "type": "array",
          "description": "Deprecated 패키지 목록",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "reason": { "type": "string" },
              "alternative": { "type": "string" }
            }
          }
        }
      }
    },
    "metrics": {
      "type": "object",
      "description": "종합 메트릭스",
      "properties": {
        "total_projects": {
          "type": "integer",
          "description": "총 프로젝트 수"
        },
        "total_packages": {
          "type": "integer",
          "description": "총 NuGet 패키지 수"
        },
        "total_project_references": {
          "type": "integer",
          "description": "총 프로젝트 참조 수"
        },
        "architecture_violations": {
          "type": "integer",
          "description": "아키텍처 위반 수"
        },
        "version_mismatches": {
          "type": "integer",
          "description": "버전 불일치 수"
        },
        "circular_references": {
          "type": "integer",
          "description": "순환 참조 수"
        },
        "layer_distribution": {
          "type": "object",
          "description": "레이어별 프로젝트 분포",
          "additionalProperties": {
            "type": "integer"
          }
        }
      }
    }
  }
}
