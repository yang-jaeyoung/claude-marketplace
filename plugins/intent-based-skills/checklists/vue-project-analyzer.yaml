# Vue Project Analyzer - Verification Checklist
# 분석 결과 검증 체크리스트

version: "1.0"

# ============================================================
# 사전 조건 검증 (PRE)
# ============================================================
pre_execution:
  - id: PRE-001
    name: "프로젝트 디렉토리 존재"
    description: "분석할 Vue 프로젝트 디렉토리가 존재하는지 확인"
    validation: auto
    script: |
      test -d "$PROJECT_PATH"
    error_message: "프로젝트 디렉토리를 찾을 수 없습니다: $PROJECT_PATH"
    priority: must

  - id: PRE-002
    name: "package.json 존재"
    description: "package.json 파일이 존재하는지 확인"
    validation: auto
    script: |
      test -f "$PROJECT_PATH/package.json"
    error_message: "package.json 파일이 없습니다"
    priority: must

  - id: PRE-003
    name: "Vue 의존성 존재"
    description: "Vue 의존성이 package.json에 있는지 확인"
    validation: auto
    script: |
      grep -q "\"vue\"" "$PROJECT_PATH/package.json"
    error_message: "Vue 의존성이 package.json에 없습니다"
    priority: must

  - id: PRE-004
    name: "출력 디렉토리 쓰기 가능"
    description: "출력 디렉토리에 파일을 생성할 수 있는지 확인"
    validation: auto
    script: |
      mkdir -p "$OUTPUT_DIR" && test -w "$OUTPUT_DIR"
    error_message: "출력 디렉토리에 쓰기 권한이 없습니다"
    priority: must

# ============================================================
# 파일 존재 검증 (FILE)
# ============================================================
post_execution:
  files:
    - id: FILE-001
      name: "ARCHITECTURE.md 생성됨"
      description: "종합 아키텍처 문서가 생성되었는지 확인"
      validation: auto
      script: |
        test -f "$OUTPUT_DIR/ARCHITECTURE.md" && test -s "$OUTPUT_DIR/ARCHITECTURE.md"
      error_message: "ARCHITECTURE.md 파일이 생성되지 않았거나 비어있습니다"
      priority: must

    - id: FILE-002
      name: "analysis-data.json 생성됨"
      description: "분석 데이터 JSON 파일이 생성되었는지 확인"
      validation: auto
      script: |
        test -f "$OUTPUT_DIR/analysis-data.json" && test -s "$OUTPUT_DIR/analysis-data.json"
      error_message: "analysis-data.json 파일이 생성되지 않았거나 비어있습니다"
      priority: must

    - id: FILE-003
      name: "diagrams 디렉토리 존재"
      description: "다이어그램 디렉토리가 생성되었는지 확인"
      validation: auto
      script: |
        test -d "$OUTPUT_DIR/diagrams"
      error_message: "diagrams 디렉토리가 생성되지 않았습니다"
      priority: must

    - id: FILE-004
      name: "component-tree.mmd 생성됨"
      description: "컴포넌트 계층 구조 다이어그램이 생성되었는지 확인"
      validation: auto
      script: |
        test -f "$OUTPUT_DIR/diagrams/component-tree.mmd"
      error_message: "component-tree.mmd 파일이 생성되지 않았습니다"
      priority: must

    - id: FILE-005
      name: "component-deps.mmd 생성됨"
      description: "컴포넌트 의존성 그래프가 생성되었는지 확인"
      validation: auto
      script: |
        test -f "$OUTPUT_DIR/diagrams/component-deps.mmd"
      error_message: "component-deps.mmd 파일이 생성되지 않았습니다"
      priority: must

    - id: FILE-006
      name: "store-structure.mmd 생성됨"
      description: "상태관리 구조 다이어그램이 생성되었는지 확인"
      validation: auto
      script: |
        test -f "$OUTPUT_DIR/diagrams/store-structure.mmd"
      error_message: "store-structure.mmd 파일이 생성되지 않았습니다"
      priority: should

    - id: FILE-007
      name: "route-tree.mmd 생성됨"
      description: "라우팅 구조 다이어그램이 생성되었는지 확인"
      validation: auto
      script: |
        test -f "$OUTPUT_DIR/diagrams/route-tree.mmd"
      error_message: "route-tree.mmd 파일이 생성되지 않았습니다"
      priority: should

# ============================================================
# 유효성 검증 (VALID)
# ============================================================
  validity:
    - id: VALID-001
      name: "analysis-data.json 유효한 JSON"
      description: "분석 데이터가 유효한 JSON 형식인지 확인"
      validation: auto
      script: |
        python3 -c "import json; json.load(open('$OUTPUT_DIR/analysis-data.json'))" 2>/dev/null || \
        node -e "JSON.parse(require('fs').readFileSync('$OUTPUT_DIR/analysis-data.json'))" 2>/dev/null || \
        jq . "$OUTPUT_DIR/analysis-data.json" >/dev/null 2>&1
      error_message: "analysis-data.json이 유효한 JSON 형식이 아닙니다"
      priority: must

    - id: VALID-002
      name: "component-tree.mmd Mermaid 문법 유효"
      description: "컴포넌트 트리가 유효한 Mermaid 문법인지 확인"
      validation: auto
      script: |
        head -5 "$OUTPUT_DIR/diagrams/component-tree.mmd" | grep -qE "^(flowchart|graph|%%)"
      error_message: "component-tree.mmd가 유효한 Mermaid 형식이 아닙니다"
      priority: should

    - id: VALID-003
      name: "component-deps.mmd Mermaid 문법 유효"
      description: "컴포넌트 의존성 그래프가 유효한 Mermaid 문법인지 확인"
      validation: auto
      script: |
        head -5 "$OUTPUT_DIR/diagrams/component-deps.mmd" | grep -qE "^(flowchart|graph|%%)"
      error_message: "component-deps.mmd가 유효한 Mermaid 형식이 아닙니다"
      priority: should

# ============================================================
# 내용 검증 (CONTENT)
# ============================================================
  content:
    - id: CONTENT-001
      name: "ARCHITECTURE.md 필수 섹션 포함"
      description: "아키텍처 문서에 필수 섹션이 모두 포함되었는지 확인"
      validation: auto
      script: |
        grep -q "## 개요\|## Overview" "$OUTPUT_DIR/ARCHITECTURE.md" && \
        grep -q "## 컴포넌트\|## Component" "$OUTPUT_DIR/ARCHITECTURE.md" && \
        grep -q "## 상태관리\|## State" "$OUTPUT_DIR/ARCHITECTURE.md"
      error_message: "ARCHITECTURE.md에 필수 섹션(개요, 컴포넌트, 상태관리)이 누락되었습니다"
      priority: should

    - id: CONTENT-002
      name: "모든 .vue 파일 포함"
      description: "프로젝트의 모든 .vue 파일이 분석에 포함되었는지 확인"
      validation: auto
      script: |
        # 프로젝트의 .vue 파일 수와 분석된 컴포넌트 수 비교
        EXPECTED=$(find "$PROJECT_PATH/src" -name "*.vue" 2>/dev/null | wc -l || echo "0")
        ACTUAL=$(python3 -c "import json; print(len(json.load(open('$OUTPUT_DIR/analysis-data.json'))['components']))" 2>/dev/null || echo "0")
        test "$ACTUAL" -ge "$EXPECTED"
      error_message: "일부 .vue 파일이 분석에서 누락되었습니다"
      priority: should

    - id: CONTENT-003
      name: "컴포넌트 분류 완료"
      description: "모든 컴포넌트가 카테고리로 분류되었는지 확인"
      validation: auto
      script: |
        UNCLASSIFIED=$(python3 -c "import json; data = json.load(open('$OUTPUT_DIR/analysis-data.json')); unclassified = [c['name'] for c in data.get('components', []) if c.get('category') == 'Unclassified']; print(len(unclassified))" 2>/dev/null || echo "999")
        test "$UNCLASSIFIED" -eq "0"
      error_message: "일부 컴포넌트가 카테고리로 분류되지 않았습니다"
      priority: should

    - id: CONTENT-004
      name: "메타데이터 포함"
      description: "analysis-data.json에 메타데이터가 포함되었는지 확인"
      validation: auto
      script: |
        python3 -c "import json; data = json.load(open('$OUTPUT_DIR/analysis-data.json')); assert 'meta' in data; assert 'generated_at' in data['meta']; assert 'skill_version' in data['meta']" 2>/dev/null
      error_message: "분석 데이터에 메타데이터가 누락되었습니다"
      priority: should

    - id: CONTENT-005
      name: "Vue 버전 정보 포함"
      description: "Vue 버전 정보가 분석 결과에 포함되었는지 확인"
      validation: auto
      script: |
        python3 -c "import json; data = json.load(open('$OUTPUT_DIR/analysis-data.json')); assert 'project' in data; assert 'vueVersion' in data['project']" 2>/dev/null
      error_message: "Vue 버전 정보가 누락되었습니다"
      priority: should

# ============================================================
# 정확성 검증 (ACCURACY) - 수동 확인 필요
# ============================================================
  accuracy:
    - id: ACCURACY-001
      name: "컴포넌트 분류 정확성"
      description: "컴포넌트가 실제 용도에 맞게 분류되었는지 확인"
      validation: manual
      guidance: |
        다음을 확인하세요:
        1. Page: views/ 또는 pages/ 아래 컴포넌트
        2. Layout: 레이아웃 래퍼 컴포넌트
        3. Common: 범용 재사용 컴포넌트
        4. Feature: 특정 기능에 종속된 컴포넌트
        5. Base: 기초 UI 컴포넌트 (버튼, 인풋 등)
      priority: should

    - id: ACCURACY-002
      name: "컴포넌트 의존성 정확성"
      description: "컴포넌트 간 의존성이 정확히 파악되었는지 확인"
      validation: manual
      guidance: |
        다음을 확인하세요:
        1. import 문이 정확히 분석되었는지
        2. 동적 import가 감지되었는지
        3. alias 경로(@/)가 올바르게 해석되었는지
        4. 순환 의존성이 정확히 감지되었는지
      priority: should

    - id: ACCURACY-003
      name: "상태관리 분석 정확성"
      description: "Pinia/Vuex 구조가 정확히 분석되었는지 확인"
      validation: manual
      guidance: |
        다음을 확인하세요:
        1. 모든 store가 감지되었는지
        2. state, getters, actions가 정확히 추출되었는지
        3. store 간 의존성이 정확한지
      priority: should

    - id: ACCURACY-004
      name: "라우팅 분석 정확성"
      description: "라우팅 구조가 정확히 분석되었는지 확인"
      validation: manual
      guidance: |
        다음을 확인하세요:
        1. 모든 라우트가 감지되었는지
        2. 중첩 라우트가 올바르게 표현되었는지
        3. 동적 라우트(:id 등)가 식별되었는지
        4. 네비게이션 가드가 감지되었는지
      priority: could

# ============================================================
# 문서화 검증 (DOC)
# ============================================================
  documentation:
    - id: DOC-001
      name: "ARCHITECTURE.md 문서화 완성도"
      description: "필수 섹션이 모두 포함되고 내용이 충분한지 확인"
      validation: manual
      guidance: |
        다음 섹션이 포함되었는지 확인:
        1. 프로젝트 개요
        2. 디렉토리 구조
        3. 컴포넌트 분석
        4. 상태관리 분석
        5. 라우팅 분석
        6. 의존성 분석
      priority: should

    - id: DOC-002
      name: "다이어그램 가독성"
      description: "생성된 Mermaid 다이어그램이 이해하기 쉬운지 확인"
      validation: manual
      guidance: |
        다음을 확인하세요:
        1. 다이어그램이 너무 복잡하지 않은지
        2. 노드 이름이 명확한지
        3. 연결선이 올바른 방향인지
      priority: could

# ============================================================
# 테스트/검토 검증 (TEST)
# ============================================================
  testing:
    - id: TEST-001
      name: "문서 이해도 테스트"
      description: "생성된 문서만으로 프로젝트 구조를 이해할 수 있는지 확인"
      validation: manual
      priority: should
      guidance: |
        다음을 확인하세요:
        1. 새로운 개발자가 문서만으로 프로젝트 구조 파악 가능
        2. 컴포넌트 계층 구조가 명확히 이해됨
        3. 상태관리 흐름을 파악할 수 있음

# ============================================================
# 요약
# ============================================================
summary:
  must_count: 8
  should_count: 14
  could_count: 2

  categories:
    - name: "사전 조건 (PRE)"
      count: 4
    - name: "파일 존재 (FILE)"
      count: 7
    - name: "유효성 (VALID)"
      count: 3
    - name: "내용 (CONTENT)"
      count: 5
    - name: "정확성 (ACCURACY)"
      count: 4
    - name: "문서화 (DOC)"
      count: 2
    - name: "테스트 (TEST)"
      count: 1
